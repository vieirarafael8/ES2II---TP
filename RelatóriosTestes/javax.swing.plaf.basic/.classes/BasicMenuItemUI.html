


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html id="htmlId">
<head>
  <title>Coverage Report :: BasicMenuItemUI</title>
  <style type="text/css">
    @import "../../.css/coverage.css";
  </style>
</head>

<body>
<div class="header"></div>

<div class="content">
<div class="breadCrumbs">
    [ <a href="../../index.html">all classes</a> ]
    [ <a href="../index.html">javax.swing.plaf.basic</a> ]
</div>

<h1>Coverage Summary for Class: BasicMenuItemUI (javax.swing.plaf.basic)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">BasicMenuItemUI</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 43)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 333)
  </span>
</td>
</tr>
  <tr>
    <td class="name">BasicMenuItemUI$Actions</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">BasicMenuItemUI$Handler</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 9)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 49)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">BasicMenuItemUI$MouseInputHandler</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 8)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 8)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 62)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/ 394)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<div class="sourceCode"><i>1</i>&nbsp;/*
<i>2</i>&nbsp; * Copyright (c) 1997, 2018, Oracle and/or its affiliates. All rights reserved.
<i>3</i>&nbsp; * ORACLE PROPRIETARY/CONFIDENTIAL. Use is subject to license terms.
<i>4</i>&nbsp; *
<i>5</i>&nbsp; *
<i>6</i>&nbsp; *
<i>7</i>&nbsp; *
<i>8</i>&nbsp; *
<i>9</i>&nbsp; *
<i>10</i>&nbsp; *
<i>11</i>&nbsp; *
<i>12</i>&nbsp; *
<i>13</i>&nbsp; *
<i>14</i>&nbsp; *
<i>15</i>&nbsp; *
<i>16</i>&nbsp; *
<i>17</i>&nbsp; *
<i>18</i>&nbsp; *
<i>19</i>&nbsp; *
<i>20</i>&nbsp; *
<i>21</i>&nbsp; *
<i>22</i>&nbsp; *
<i>23</i>&nbsp; *
<i>24</i>&nbsp; */
<i>25</i>&nbsp;
<i>26</i>&nbsp;package javax.swing.plaf.basic;
<i>27</i>&nbsp;
<i>28</i>&nbsp;import java.awt.*;
<i>29</i>&nbsp;import java.awt.event.*;
<i>30</i>&nbsp;import java.beans.PropertyChangeEvent;
<i>31</i>&nbsp;import java.beans.PropertyChangeListener;
<i>32</i>&nbsp;
<i>33</i>&nbsp;import javax.swing.*;
<i>34</i>&nbsp;import javax.swing.event.*;
<i>35</i>&nbsp;import javax.swing.plaf.*;
<i>36</i>&nbsp;import javax.swing.text.View;
<i>37</i>&nbsp;
<i>38</i>&nbsp;import sun.swing.*;
<i>39</i>&nbsp;
<i>40</i>&nbsp;/**
<i>41</i>&nbsp; * BasicMenuItem implementation
<i>42</i>&nbsp; *
<i>43</i>&nbsp; * @author Georges Saab
<i>44</i>&nbsp; * @author David Karlton
<i>45</i>&nbsp; * @author Arnaud Weber
<i>46</i>&nbsp; * @author Fredrik Lagerblad
<i>47</i>&nbsp; */
<b class="nc"><i>48</i>&nbsp;public class BasicMenuItemUI extends MenuItemUI</b>
<i>49</i>&nbsp;{
<b class="nc"><i>50</i>&nbsp;    /**</b>
<i>51</i>&nbsp;     * The instance of {@code JMenuItem}.
<i>52</i>&nbsp;     */
<i>53</i>&nbsp;    protected JMenuItem menuItem = null;
<i>54</i>&nbsp;    /**
<i>55</i>&nbsp;     * The color of the selection background.
<i>56</i>&nbsp;     */
<i>57</i>&nbsp;    protected Color selectionBackground;
<i>58</i>&nbsp;    /**
<i>59</i>&nbsp;     * The color of the selection foreground.
<i>60</i>&nbsp;     */
<i>61</i>&nbsp;    protected Color selectionForeground;
<i>62</i>&nbsp;    /**
<i>63</i>&nbsp;     * The color of the disabled foreground.
<i>64</i>&nbsp;     */
<i>65</i>&nbsp;    protected Color disabledForeground;
<i>66</i>&nbsp;    /**
<i>67</i>&nbsp;     * The color of the accelerator foreground.
<i>68</i>&nbsp;     */
<i>69</i>&nbsp;    protected Color acceleratorForeground;
<i>70</i>&nbsp;    /**
<i>71</i>&nbsp;     * The color of the accelerator selection.
<i>72</i>&nbsp;     */
<i>73</i>&nbsp;    protected Color acceleratorSelectionForeground;
<i>74</i>&nbsp;
<i>75</i>&nbsp;    /**
<i>76</i>&nbsp;     * Accelerator delimiter string, such as {@code &#39;+&#39;} in {@code &#39;Ctrl+C&#39;}.
<i>77</i>&nbsp;     * @since 1.7
<i>78</i>&nbsp;     */
<i>79</i>&nbsp;    protected String acceleratorDelimiter;
<i>80</i>&nbsp;
<i>81</i>&nbsp;    /**
<i>82</i>&nbsp;     * The gap between the text and the icon.
<b class="nc"><i>83</i>&nbsp;     */</b>
<b class="nc"><i>84</i>&nbsp;    protected int defaultTextIconGap;</b>
<i>85</i>&nbsp;    /**
<i>86</i>&nbsp;     * The accelerator font.
<i>87</i>&nbsp;     */
<i>88</i>&nbsp;    protected Font acceleratorFont;
<i>89</i>&nbsp;
<i>90</i>&nbsp;    /**
<i>91</i>&nbsp;     * The instance of {@code MouseInputListener}.
<i>92</i>&nbsp;     */
<i>93</i>&nbsp;    protected MouseInputListener mouseInputListener;
<i>94</i>&nbsp;    /**
<i>95</i>&nbsp;     * The instance of {@code MenuDragMouseListener}.
<b class="nc"><i>96</i>&nbsp;     */</b>
<b class="nc"><i>97</i>&nbsp;    protected MenuDragMouseListener menuDragMouseListener;</b>
<i>98</i>&nbsp;    /**
<i>99</i>&nbsp;     * The instance of {@code MenuKeyListener}.
<i>100</i>&nbsp;     */
<b class="nc"><i>101</i>&nbsp;    protected MenuKeyListener menuKeyListener;</b>
<i>102</i>&nbsp;    /**
<i>103</i>&nbsp;     * {@code PropertyChangeListener} returned from
<i>104</i>&nbsp;     * {@code createPropertyChangeListener}. You should not
<b class="nc"><i>105</i>&nbsp;     * need to access this field, rather if you want to customize the</b>
<i>106</i>&nbsp;     * {@code PropertyChangeListener} override
<b class="nc"><i>107</i>&nbsp;     * {@code createPropertyChangeListener}.</b>
<b class="nc"><i>108</i>&nbsp;     *</b>
<b class="nc"><i>109</i>&nbsp;     * @since 1.6</b>
<b class="nc"><i>110</i>&nbsp;     * @see #createPropertyChangeListener</b>
<i>111</i>&nbsp;     */
<i>112</i>&nbsp;    protected PropertyChangeListener propertyChangeListener;
<i>113</i>&nbsp;    // BasicMenuUI also uses this.
<i>114</i>&nbsp;    Handler handler;
<b class="nc"><i>115</i>&nbsp;    /**</b>
<i>116</i>&nbsp;     * The arrow icon.
<b class="nc"><i>117</i>&nbsp;     */</b>
<i>118</i>&nbsp;    protected Icon arrowIcon = null;
<i>119</i>&nbsp;    /**
<b class="nc"><i>120</i>&nbsp;     * The check icon.</b>
<b class="nc"><i>121</i>&nbsp;     */</b>
<i>122</i>&nbsp;    protected Icon checkIcon = null;
<i>123</i>&nbsp;    /**
<b class="nc"><i>124</i>&nbsp;     * The value represents if the old border is painted.</b>
<b class="nc"><i>125</i>&nbsp;     */</b>
<b class="nc"><i>126</i>&nbsp;    protected boolean oldBorderPainted;</b>
<i>127</i>&nbsp;
<i>128</i>&nbsp;    /* diagnostic aids -- should be false for production builds. */
<b class="nc"><i>129</i>&nbsp;    private static final boolean TRACE =   false; // trace creates and disposes</b>
<i>130</i>&nbsp;
<b class="nc"><i>131</i>&nbsp;    private static final boolean VERBOSE = false; // show reuse hits/misses</b>
<b class="nc"><i>132</i>&nbsp;    private static final boolean DEBUG =   false;  // show bad params, misc.</b>
<b class="nc"><i>133</i>&nbsp;</b>
<i>134</i>&nbsp;    static void loadActionMap(LazyActionMap map) {
<i>135</i>&nbsp;        // NOTE: BasicMenuUI also calls into this method.
<b class="nc"><i>136</i>&nbsp;        map.put(new Actions(Actions.CLICK));</b>
<b class="nc"><i>137</i>&nbsp;        BasicLookAndFeel.installAudioActionMap(map);</b>
<i>138</i>&nbsp;    }
<b class="nc"><i>139</i>&nbsp;</b>
<b class="nc"><i>140</i>&nbsp;    /**</b>
<b class="nc"><i>141</i>&nbsp;     * Returns a new instance of {@code BasicMenuItemUI}.</b>
<b class="nc"><i>142</i>&nbsp;     *</b>
<b class="nc"><i>143</i>&nbsp;     * @param c a component</b>
<i>144</i>&nbsp;     * @return a new instance of {@code BasicMenuItemUI}
<i>145</i>&nbsp;     */
<i>146</i>&nbsp;    public static ComponentUI createUI(JComponent c) {
<i>147</i>&nbsp;        return new BasicMenuItemUI();
<i>148</i>&nbsp;    }
<b class="nc"><i>149</i>&nbsp;</b>
<i>150</i>&nbsp;    public void installUI(JComponent c) {
<b class="nc"><i>151</i>&nbsp;        menuItem = (JMenuItem) c;</b>
<b class="nc"><i>152</i>&nbsp;</b>
<i>153</i>&nbsp;        installDefaults();
<b class="nc"><i>154</i>&nbsp;        installComponents(menuItem);</b>
<i>155</i>&nbsp;        installListeners();
<b class="nc"><i>156</i>&nbsp;        installKeyboardActions();</b>
<b class="nc"><i>157</i>&nbsp;    }</b>
<i>158</i>&nbsp;
<b class="nc"><i>159</i>&nbsp;    /**</b>
<i>160</i>&nbsp;     * Installs default properties.
<b class="nc"><i>161</i>&nbsp;     */</b>
<b class="nc"><i>162</i>&nbsp;    protected void installDefaults() {</b>
<i>163</i>&nbsp;        String prefix = getPropertyPrefix();
<b class="nc"><i>164</i>&nbsp;</b>
<i>165</i>&nbsp;        acceleratorFont = UIManager.getFont(&quot;MenuItem.acceleratorFont&quot;);
<b class="nc"><i>166</i>&nbsp;        // use default if missing so that BasicMenuItemUI can be used in other</b>
<b class="nc"><i>167</i>&nbsp;        // LAFs like Nimbus</b>
<i>168</i>&nbsp;        if (acceleratorFont == null) {
<b class="nc"><i>169</i>&nbsp;            acceleratorFont = UIManager.getFont(&quot;MenuItem.font&quot;);</b>
<i>170</i>&nbsp;        }
<b class="nc"><i>171</i>&nbsp;</b>
<b class="nc"><i>172</i>&nbsp;        Object opaque = UIManager.get(getPropertyPrefix() + &quot;.opaque&quot;);</b>
<i>173</i>&nbsp;        if (opaque != null) {
<i>174</i>&nbsp;            LookAndFeel.installProperty(menuItem, &quot;opaque&quot;, opaque);
<b class="nc"><i>175</i>&nbsp;        }</b>
<b class="nc"><i>176</i>&nbsp;        else {</b>
<b class="nc"><i>177</i>&nbsp;            LookAndFeel.installProperty(menuItem, &quot;opaque&quot;, Boolean.TRUE);</b>
<i>178</i>&nbsp;        }
<b class="nc"><i>179</i>&nbsp;        if(menuItem.getMargin() == null ||</b>
<i>180</i>&nbsp;           (menuItem.getMargin() instanceof UIResource)) {
<b class="nc"><i>181</i>&nbsp;            menuItem.setMargin(UIManager.getInsets(prefix + &quot;.margin&quot;));</b>
<i>182</i>&nbsp;        }
<b class="nc"><i>183</i>&nbsp;</b>
<i>184</i>&nbsp;        LookAndFeel.installProperty(menuItem, &quot;iconTextGap&quot;, Integer.valueOf(4));
<i>185</i>&nbsp;        defaultTextIconGap = menuItem.getIconTextGap();
<i>186</i>&nbsp;
<i>187</i>&nbsp;        LookAndFeel.installBorder(menuItem, prefix + &quot;.border&quot;);
<i>188</i>&nbsp;        oldBorderPainted = menuItem.isBorderPainted();
<i>189</i>&nbsp;        LookAndFeel.installProperty(menuItem, &quot;borderPainted&quot;,
<b class="nc"><i>190</i>&nbsp;                                    UIManager.getBoolean(prefix + &quot;.borderPainted&quot;));</b>
<i>191</i>&nbsp;        LookAndFeel.installColorsAndFont(menuItem,
<b class="nc"><i>192</i>&nbsp;                                         prefix + &quot;.background&quot;,</b>
<i>193</i>&nbsp;                                         prefix + &quot;.foreground&quot;,
<b class="nc"><i>194</i>&nbsp;                                         prefix + &quot;.font&quot;);</b>
<i>195</i>&nbsp;
<i>196</i>&nbsp;        // MenuItem specific defaults
<i>197</i>&nbsp;        if (selectionBackground == null ||
<b class="nc"><i>198</i>&nbsp;            selectionBackground instanceof UIResource) {</b>
<b class="nc"><i>199</i>&nbsp;            selectionBackground =</b>
<b class="nc"><i>200</i>&nbsp;                UIManager.getColor(prefix + &quot;.selectionBackground&quot;);</b>
<b class="nc"><i>201</i>&nbsp;        }</b>
<b class="nc"><i>202</i>&nbsp;        if (selectionForeground == null ||</b>
<i>203</i>&nbsp;            selectionForeground instanceof UIResource) {
<b class="nc"><i>204</i>&nbsp;            selectionForeground =</b>
<b class="nc"><i>205</i>&nbsp;                UIManager.getColor(prefix + &quot;.selectionForeground&quot;);</b>
<b class="nc"><i>206</i>&nbsp;        }</b>
<b class="nc"><i>207</i>&nbsp;        if (disabledForeground == null ||</b>
<i>208</i>&nbsp;            disabledForeground instanceof UIResource) {
<i>209</i>&nbsp;            disabledForeground =
<i>210</i>&nbsp;                UIManager.getColor(prefix + &quot;.disabledForeground&quot;);
<i>211</i>&nbsp;        }
<i>212</i>&nbsp;        if (acceleratorForeground == null ||
<i>213</i>&nbsp;            acceleratorForeground instanceof UIResource) {
<i>214</i>&nbsp;            acceleratorForeground =
<i>215</i>&nbsp;                UIManager.getColor(prefix + &quot;.acceleratorForeground&quot;);
<i>216</i>&nbsp;        }
<b class="nc"><i>217</i>&nbsp;        if (acceleratorSelectionForeground == null ||</b>
<i>218</i>&nbsp;            acceleratorSelectionForeground instanceof UIResource) {
<i>219</i>&nbsp;            acceleratorSelectionForeground =
<i>220</i>&nbsp;                UIManager.getColor(prefix + &quot;.acceleratorSelectionForeground&quot;);
<b class="nc"><i>221</i>&nbsp;        }</b>
<i>222</i>&nbsp;        // Get accelerator delimiter
<i>223</i>&nbsp;        acceleratorDelimiter =
<i>224</i>&nbsp;            UIManager.getString(&quot;MenuItem.acceleratorDelimiter&quot;);
<b class="nc"><i>225</i>&nbsp;        if (acceleratorDelimiter == null) { acceleratorDelimiter = &quot;+&quot;; }</b>
<b class="nc"><i>226</i>&nbsp;        // Icons</b>
<b class="nc"><i>227</i>&nbsp;        if (arrowIcon == null ||</b>
<i>228</i>&nbsp;            arrowIcon instanceof UIResource) {
<b class="nc"><i>229</i>&nbsp;            arrowIcon = UIManager.getIcon(prefix + &quot;.arrowIcon&quot;);</b>
<b class="nc"><i>230</i>&nbsp;        }</b>
<i>231</i>&nbsp;        updateCheckIcon();
<b class="nc"><i>232</i>&nbsp;    }</b>
<b class="nc"><i>233</i>&nbsp;</b>
<i>234</i>&nbsp;    /**
<b class="nc"><i>235</i>&nbsp;     * Updates check Icon based on column layout</b>
<b class="nc"><i>236</i>&nbsp;     */</b>
<i>237</i>&nbsp;    private void updateCheckIcon() {
<i>238</i>&nbsp;        String prefix = getPropertyPrefix();
<i>239</i>&nbsp;
<i>240</i>&nbsp;        if (checkIcon == null ||
<b class="nc"><i>241</i>&nbsp;            checkIcon instanceof UIResource) {</b>
<b class="nc"><i>242</i>&nbsp;            checkIcon = UIManager.getIcon(prefix + &quot;.checkIcon&quot;);</b>
<i>243</i>&nbsp;            //In case of column layout, .checkIconFactory is defined for this UI,
<i>244</i>&nbsp;            //the icon is compatible with it and useCheckAndArrow() is true,
<i>245</i>&nbsp;            //then the icon is handled by the checkIcon.
<b class="nc"><i>246</i>&nbsp;            boolean isColumnLayout = MenuItemLayoutHelper.isColumnLayout(</b>
<b class="nc"><i>247</i>&nbsp;                    BasicGraphicsUtils.isLeftToRight(menuItem), menuItem);</b>
<i>248</i>&nbsp;            if (isColumnLayout) {
<i>249</i>&nbsp;                MenuItemCheckIconFactory iconFactory =
<i>250</i>&nbsp;                        (MenuItemCheckIconFactory) UIManager.get(prefix
<b class="nc"><i>251</i>&nbsp;                                + &quot;.checkIconFactory&quot;);</b>
<b class="nc"><i>252</i>&nbsp;                if (iconFactory != null</b>
<b class="nc"><i>253</i>&nbsp;                        &amp;&amp; MenuItemLayoutHelper.useCheckAndArrow(menuItem)</b>
<b class="nc"><i>254</i>&nbsp;                        &amp;&amp; iconFactory.isCompatible(checkIcon, prefix)) {</b>
<b class="nc"><i>255</i>&nbsp;                    checkIcon = iconFactory.getIcon(menuItem);</b>
<b class="nc"><i>256</i>&nbsp;                }</b>
<b class="nc"><i>257</i>&nbsp;            }</b>
<i>258</i>&nbsp;        }
<i>259</i>&nbsp;    }
<i>260</i>&nbsp;
<i>261</i>&nbsp;    /**
<b class="nc"><i>262</i>&nbsp;     *</b>
<b class="nc"><i>263</i>&nbsp;     * @param menuItem a menu item</b>
<b class="nc"><i>264</i>&nbsp;     * @since 1.3</b>
<b class="nc"><i>265</i>&nbsp;     */</b>
<b class="nc"><i>266</i>&nbsp;    protected void installComponents(JMenuItem menuItem){</b>
<b class="nc"><i>267</i>&nbsp;        BasicHTML.updateRenderer(menuItem, menuItem.getText());</b>
<b class="nc"><i>268</i>&nbsp;    }</b>
<b class="nc"><i>269</i>&nbsp;</b>
<i>270</i>&nbsp;    /**
<i>271</i>&nbsp;     * Returns a property prefix.
<i>272</i>&nbsp;     *
<i>273</i>&nbsp;     * @return a property prefix
<i>274</i>&nbsp;     */
<i>275</i>&nbsp;    protected String getPropertyPrefix() {
<b class="nc"><i>276</i>&nbsp;        return &quot;MenuItem&quot;;</b>
<i>277</i>&nbsp;    }
<i>278</i>&nbsp;
<i>279</i>&nbsp;    /**
<b class="nc"><i>280</i>&nbsp;     * Registers listeners.</b>
<b class="nc"><i>281</i>&nbsp;     */</b>
<b class="nc"><i>282</i>&nbsp;    protected void installListeners() {</b>
<i>283</i>&nbsp;        if ((mouseInputListener = createMouseInputListener(menuItem)) != null) {
<b class="nc"><i>284</i>&nbsp;            menuItem.addMouseListener(mouseInputListener);</b>
<b class="nc"><i>285</i>&nbsp;            menuItem.addMouseMotionListener(mouseInputListener);</b>
<i>286</i>&nbsp;        }
<b class="nc"><i>287</i>&nbsp;        if ((menuDragMouseListener = createMenuDragMouseListener(menuItem)) != null) {</b>
<b class="nc"><i>288</i>&nbsp;            menuItem.addMenuDragMouseListener(menuDragMouseListener);</b>
<i>289</i>&nbsp;        }
<b class="nc"><i>290</i>&nbsp;        if ((menuKeyListener = createMenuKeyListener(menuItem)) != null) {</b>
<b class="nc"><i>291</i>&nbsp;            menuItem.addMenuKeyListener(menuKeyListener);</b>
<i>292</i>&nbsp;        }
<i>293</i>&nbsp;        if ((propertyChangeListener = createPropertyChangeListener(menuItem)) != null) {
<b class="nc"><i>294</i>&nbsp;            menuItem.addPropertyChangeListener(propertyChangeListener);</b>
<b class="nc"><i>295</i>&nbsp;        }</b>
<b class="nc"><i>296</i>&nbsp;    }</b>
<b class="nc"><i>297</i>&nbsp;</b>
<b class="nc"><i>298</i>&nbsp;    /**</b>
<i>299</i>&nbsp;     * Registers keyboard action.
<i>300</i>&nbsp;     */
<i>301</i>&nbsp;    protected void installKeyboardActions() {
<b class="nc"><i>302</i>&nbsp;        installLazyActionMap();</b>
<b class="nc"><i>303</i>&nbsp;        updateAcceleratorBinding();</b>
<i>304</i>&nbsp;    }
<i>305</i>&nbsp;
<i>306</i>&nbsp;    void installLazyActionMap() {
<i>307</i>&nbsp;        LazyActionMap.installLazyActionMap(menuItem, BasicMenuItemUI.class,
<b class="nc"><i>308</i>&nbsp;                                           getPropertyPrefix() + &quot;.actionMap&quot;);</b>
<i>309</i>&nbsp;    }
<i>310</i>&nbsp;
<i>311</i>&nbsp;    public void uninstallUI(JComponent c) {
<b class="nc"><i>312</i>&nbsp;        menuItem = (JMenuItem)c;</b>
<i>313</i>&nbsp;        uninstallDefaults();
<i>314</i>&nbsp;        uninstallComponents(menuItem);
<i>315</i>&nbsp;        uninstallListeners();
<b class="nc"><i>316</i>&nbsp;        uninstallKeyboardActions();</b>
<i>317</i>&nbsp;        MenuItemLayoutHelper.clearUsedParentClientProperties(menuItem);
<i>318</i>&nbsp;        menuItem = null;
<i>319</i>&nbsp;    }
<i>320</i>&nbsp;
<i>321</i>&nbsp;    /**
<i>322</i>&nbsp;     * Uninstalls default properties.
<i>323</i>&nbsp;     */
<i>324</i>&nbsp;    protected void uninstallDefaults() {
<i>325</i>&nbsp;        LookAndFeel.uninstallBorder(menuItem);
<i>326</i>&nbsp;        LookAndFeel.installProperty(menuItem, &quot;borderPainted&quot;, oldBorderPainted);
<i>327</i>&nbsp;        if (menuItem.getMargin() instanceof UIResource)
<i>328</i>&nbsp;            menuItem.setMargin(null);
<b class="nc"><i>329</i>&nbsp;        if (arrowIcon instanceof UIResource)</b>
<i>330</i>&nbsp;            arrowIcon = null;
<i>331</i>&nbsp;        if (checkIcon instanceof UIResource)
<i>332</i>&nbsp;            checkIcon = null;
<b class="nc"><i>333</i>&nbsp;    }</b>
<b class="nc"><i>334</i>&nbsp;</b>
<i>335</i>&nbsp;    /**
<b class="nc"><i>336</i>&nbsp;     * Unregisters components.</b>
<i>337</i>&nbsp;     *
<i>338</i>&nbsp;     * @param menuItem a menu item
<i>339</i>&nbsp;     * @since 1.3
<b class="nc"><i>340</i>&nbsp;     */</b>
<b class="nc"><i>341</i>&nbsp;    protected void uninstallComponents(JMenuItem menuItem){</b>
<i>342</i>&nbsp;        BasicHTML.updateRenderer(menuItem, &quot;&quot;);
<b class="nc"><i>343</i>&nbsp;    }</b>
<i>344</i>&nbsp;
<i>345</i>&nbsp;    /**
<i>346</i>&nbsp;     * Unregisters listeners.
<b class="nc"><i>347</i>&nbsp;     */</b>
<b class="nc"><i>348</i>&nbsp;    protected void uninstallListeners() {</b>
<i>349</i>&nbsp;        if (mouseInputListener != null) {
<i>350</i>&nbsp;            menuItem.removeMouseListener(mouseInputListener);
<b class="nc"><i>351</i>&nbsp;            menuItem.removeMouseMotionListener(mouseInputListener);</b>
<b class="nc"><i>352</i>&nbsp;        }</b>
<i>353</i>&nbsp;        if (menuDragMouseListener != null) {
<b class="nc"><i>354</i>&nbsp;            menuItem.removeMenuDragMouseListener(menuDragMouseListener);</b>
<b class="nc"><i>355</i>&nbsp;        }</b>
<b class="nc"><i>356</i>&nbsp;        if (menuKeyListener != null) {</b>
<i>357</i>&nbsp;            menuItem.removeMenuKeyListener(menuKeyListener);
<b class="nc"><i>358</i>&nbsp;        }</b>
<i>359</i>&nbsp;        if (propertyChangeListener != null) {
<i>360</i>&nbsp;            menuItem.removePropertyChangeListener(propertyChangeListener);
<b class="nc"><i>361</i>&nbsp;        }</b>
<i>362</i>&nbsp;
<i>363</i>&nbsp;        mouseInputListener = null;
<i>364</i>&nbsp;        menuDragMouseListener = null;
<i>365</i>&nbsp;        menuKeyListener = null;
<b class="nc"><i>366</i>&nbsp;        propertyChangeListener = null;</b>
<b class="nc"><i>367</i>&nbsp;        handler = null;</b>
<b class="nc"><i>368</i>&nbsp;    }</b>
<b class="nc"><i>369</i>&nbsp;</b>
<b class="nc"><i>370</i>&nbsp;    /**</b>
<i>371</i>&nbsp;     * Unregisters keyboard actions.
<b class="nc"><i>372</i>&nbsp;     */</b>
<i>373</i>&nbsp;    protected void uninstallKeyboardActions() {
<i>374</i>&nbsp;        SwingUtilities.replaceUIActionMap(menuItem, null);
<i>375</i>&nbsp;        SwingUtilities.replaceUIInputMap(menuItem, JComponent.
<b class="nc"><i>376</i>&nbsp;                                         WHEN_IN_FOCUSED_WINDOW, null);</b>
<i>377</i>&nbsp;    }
<i>378</i>&nbsp;
<i>379</i>&nbsp;    /**
<i>380</i>&nbsp;     * Returns an instance of {@code MouseInputListener}.
<i>381</i>&nbsp;     *
<i>382</i>&nbsp;     * @param c a component
<b class="nc"><i>383</i>&nbsp;     * @return an instance of {@code MouseInputListener}</b>
<b class="nc"><i>384</i>&nbsp;     */</b>
<b class="nc"><i>385</i>&nbsp;    protected MouseInputListener createMouseInputListener(JComponent c) {</b>
<b class="nc"><i>386</i>&nbsp;        return getHandler();</b>
<b class="nc"><i>387</i>&nbsp;    }</b>
<i>388</i>&nbsp;
<b class="nc"><i>389</i>&nbsp;    /**</b>
<i>390</i>&nbsp;     * Returns an instance of {@code MenuDragMouseListener}.
<i>391</i>&nbsp;     *
<i>392</i>&nbsp;     * @param c a component
<i>393</i>&nbsp;     * @return an instance of {@code MenuDragMouseListener}
<i>394</i>&nbsp;     */
<i>395</i>&nbsp;    protected MenuDragMouseListener createMenuDragMouseListener(JComponent c) {
<i>396</i>&nbsp;        return getHandler();
<i>397</i>&nbsp;    }
<i>398</i>&nbsp;
<i>399</i>&nbsp;    /**
<i>400</i>&nbsp;     * Returns an instance of {@code MenuKeyListener}.
<i>401</i>&nbsp;     *
<i>402</i>&nbsp;     * @param c a component
<i>403</i>&nbsp;     * @return an instance of {@code MenuKeyListener}
<i>404</i>&nbsp;     */
<i>405</i>&nbsp;    protected MenuKeyListener createMenuKeyListener(JComponent c) {
<i>406</i>&nbsp;        return null;
<i>407</i>&nbsp;    }
<i>408</i>&nbsp;
<i>409</i>&nbsp;    /**
<i>410</i>&nbsp;     * Creates a {@code PropertyChangeListener} which will be added to
<i>411</i>&nbsp;     * the menu item.
<i>412</i>&nbsp;     * If this method returns null then it will not be added to the menu item.
<i>413</i>&nbsp;     *
<i>414</i>&nbsp;     * @param c a component
<i>415</i>&nbsp;     * @return an instance of a {@code PropertyChangeListener} or null
<i>416</i>&nbsp;     * @since 1.6
<i>417</i>&nbsp;     */
<i>418</i>&nbsp;    protected PropertyChangeListener
<i>419</i>&nbsp;                                  createPropertyChangeListener(JComponent c) {
<b class="nc"><i>420</i>&nbsp;        return getHandler();</b>
<b class="nc"><i>421</i>&nbsp;    }</b>
<b class="nc"><i>422</i>&nbsp;</b>
<b class="nc"><i>423</i>&nbsp;    Handler getHandler() {</b>
<b class="nc"><i>424</i>&nbsp;        if (handler == null) {</b>
<b class="nc"><i>425</i>&nbsp;            handler = new Handler();</b>
<b class="nc"><i>426</i>&nbsp;        }</b>
<i>427</i>&nbsp;        return handler;
<b class="nc"><i>428</i>&nbsp;    }</b>
<i>429</i>&nbsp;
<i>430</i>&nbsp;    InputMap createInputMap(int condition) {
<b class="nc"><i>431</i>&nbsp;        if (condition == JComponent.WHEN_IN_FOCUSED_WINDOW) {</b>
<b class="nc"><i>432</i>&nbsp;            return new ComponentInputMapUIResource(menuItem);</b>
<b class="nc"><i>433</i>&nbsp;        }</b>
<i>434</i>&nbsp;        return null;
<b class="nc"><i>435</i>&nbsp;    }</b>
<b class="nc"><i>436</i>&nbsp;</b>
<b class="nc"><i>437</i>&nbsp;    @SuppressWarnings(&quot;deprecation&quot;)</b>
<b class="nc"><i>438</i>&nbsp;    void updateAcceleratorBinding() {</b>
<i>439</i>&nbsp;        KeyStroke accelerator = menuItem.getAccelerator();
<b class="nc"><i>440</i>&nbsp;        InputMap windowInputMap = SwingUtilities.getUIInputMap(</b>
<b class="nc"><i>441</i>&nbsp;                       menuItem, JComponent.WHEN_IN_FOCUSED_WINDOW);</b>
<b class="nc"><i>442</i>&nbsp;</b>
<i>443</i>&nbsp;        if (windowInputMap != null) {
<i>444</i>&nbsp;            windowInputMap.clear();
<b class="nc"><i>445</i>&nbsp;        }</b>
<b class="nc"><i>446</i>&nbsp;        if (accelerator != null) {</b>
<b class="nc"><i>447</i>&nbsp;            if (windowInputMap == null) {</b>
<i>448</i>&nbsp;                windowInputMap = createInputMap(JComponent.
<i>449</i>&nbsp;                                                WHEN_IN_FOCUSED_WINDOW);
<b class="nc"><i>450</i>&nbsp;                SwingUtilities.replaceUIInputMap(menuItem,</b>
<b class="nc"><i>451</i>&nbsp;                           JComponent.WHEN_IN_FOCUSED_WINDOW, windowInputMap);</b>
<b class="nc"><i>452</i>&nbsp;            }</b>
<b class="nc"><i>453</i>&nbsp;            windowInputMap.put(accelerator, &quot;doClick&quot;);</b>
<i>454</i>&nbsp;
<i>455</i>&nbsp;            int modifiers = accelerator.getModifiers();
<i>456</i>&nbsp;            if (((modifiers &amp; InputEvent.ALT_DOWN_MASK) != 0) &amp;&amp;
<i>457</i>&nbsp;                    ((modifiers &amp; InputEvent.ALT_GRAPH_DOWN_MASK) != 0)) {
<b class="nc"><i>458</i>&nbsp;                //When both ALT and ALT_GRAPH are set, add the ALT only</b>
<b class="nc"><i>459</i>&nbsp;                // modifier keystroke which is used for left ALT key.</b>
<i>460</i>&nbsp;                // Unsetting the ALT_GRAPH will do that as ALT is already set
<i>461</i>&nbsp;                modifiers &amp;= ~InputEvent.ALT_GRAPH_DOWN_MASK;
<i>462</i>&nbsp;                modifiers &amp;= ~InputEvent.ALT_GRAPH_MASK;
<i>463</i>&nbsp;                KeyStroke keyStroke = KeyStroke.getKeyStroke(accelerator.getKeyCode(),
<b class="nc"><i>464</i>&nbsp;                        modifiers, accelerator.isOnKeyRelease());</b>
<i>465</i>&nbsp;                windowInputMap.put(keyStroke, &quot;doClick&quot;);
<b class="nc"><i>466</i>&nbsp;            } else if (((modifiers &amp; InputEvent.ALT_DOWN_MASK) != 0) &amp;&amp; (</b>
<b class="nc"><i>467</i>&nbsp;                    (modifiers &amp; InputEvent.ALT_GRAPH_DOWN_MASK) == 0)) {</b>
<i>468</i>&nbsp;                //When only ALT modifier is set, add the ALT + ALT_GRAPH
<i>469</i>&nbsp;                // modifier keystroke which is used for right ALT key
<b class="nc"><i>470</i>&nbsp;                modifiers |= InputEvent.ALT_GRAPH_DOWN_MASK;</b>
<i>471</i>&nbsp;                KeyStroke keyStroke = KeyStroke.getKeyStroke(accelerator.getKeyCode(),
<i>472</i>&nbsp;                        modifiers, accelerator.isOnKeyRelease());
<i>473</i>&nbsp;                windowInputMap.put(keyStroke, &quot;doClick&quot;);
<i>474</i>&nbsp;            } else if ((modifiers &amp; InputEvent.ALT_GRAPH_DOWN_MASK) != 0) {
<i>475</i>&nbsp;                //When only ALT_GRAPH is set, remove the ALT_GRAPH only
<i>476</i>&nbsp;                // modifier and add the ALT and ALT+ALT_GRAPH modifiers
<i>477</i>&nbsp;                // keystroke which are used for left ALT key and right ALT
<i>478</i>&nbsp;                // respectively
<i>479</i>&nbsp;                modifiers &amp;= ~InputEvent.ALT_GRAPH_DOWN_MASK;
<b class="nc"><i>480</i>&nbsp;                modifiers &amp;= ~InputEvent.ALT_GRAPH_MASK;</b>
<i>481</i>&nbsp;
<i>482</i>&nbsp;                modifiers |= InputEvent.ALT_DOWN_MASK;
<i>483</i>&nbsp;                KeyStroke keyStroke = KeyStroke.getKeyStroke(accelerator.getKeyCode(),
<b class="nc"><i>484</i>&nbsp;                        modifiers, accelerator.isOnKeyRelease());</b>
<i>485</i>&nbsp;                windowInputMap.put(keyStroke, &quot;doClick&quot;);
<i>486</i>&nbsp;
<i>487</i>&nbsp;                //Add ALT+ALT_GRAPH modifier which is used for right ALT key
<i>488</i>&nbsp;                modifiers |= InputEvent.ALT_GRAPH_DOWN_MASK;
<i>489</i>&nbsp;                keyStroke = KeyStroke.getKeyStroke(accelerator.getKeyCode(),
<i>490</i>&nbsp;                        modifiers, accelerator.isOnKeyRelease());
<i>491</i>&nbsp;                windowInputMap.put(keyStroke, &quot;doClick&quot;);
<i>492</i>&nbsp;            }
<i>493</i>&nbsp;        }
<b class="nc"><i>494</i>&nbsp;    }</b>
<b class="nc"><i>495</i>&nbsp;</b>
<i>496</i>&nbsp;    public Dimension getMinimumSize(JComponent c) {
<b class="nc"><i>497</i>&nbsp;        Dimension d = null;</b>
<b class="nc"><i>498</i>&nbsp;        View v = (View) c.getClientProperty(BasicHTML.propertyKey);</b>
<i>499</i>&nbsp;        if (v != null) {
<b class="nc"><i>500</i>&nbsp;            d = getPreferredSize(c);</b>
<b class="nc"><i>501</i>&nbsp;            d.width -= v.getPreferredSpan(View.X_AXIS) - v.getMinimumSpan(View.X_AXIS);</b>
<i>502</i>&nbsp;        }
<b class="nc"><i>503</i>&nbsp;        return d;</b>
<i>504</i>&nbsp;    }
<b class="nc"><i>505</i>&nbsp;</b>
<b class="nc"><i>506</i>&nbsp;    public Dimension getPreferredSize(JComponent c) {</b>
<b class="nc"><i>507</i>&nbsp;        return getPreferredMenuItemSize(c,</b>
<b class="nc"><i>508</i>&nbsp;                                        checkIcon,</b>
<i>509</i>&nbsp;                                        arrowIcon,
<b class="nc"><i>510</i>&nbsp;                                        defaultTextIconGap);</b>
<b class="nc"><i>511</i>&nbsp;    }</b>
<b class="nc"><i>512</i>&nbsp;</b>
<b class="nc"><i>513</i>&nbsp;    public Dimension getMaximumSize(JComponent c) {</b>
<b class="nc"><i>514</i>&nbsp;        Dimension d = null;</b>
<b class="nc"><i>515</i>&nbsp;        View v = (View) c.getClientProperty(BasicHTML.propertyKey);</b>
<i>516</i>&nbsp;        if (v != null) {
<i>517</i>&nbsp;            d = getPreferredSize(c);
<b class="nc"><i>518</i>&nbsp;            d.width += v.getMaximumSpan(View.X_AXIS) - v.getPreferredSpan(View.X_AXIS);</b>
<b class="nc"><i>519</i>&nbsp;        }</b>
<i>520</i>&nbsp;        return d;
<i>521</i>&nbsp;    }
<i>522</i>&nbsp;
<i>523</i>&nbsp;    /**
<b class="nc"><i>524</i>&nbsp;     * Returns the preferred size of a menu item.</b>
<i>525</i>&nbsp;     *
<b class="nc"><i>526</i>&nbsp;     * @param c a component</b>
<b class="nc"><i>527</i>&nbsp;     * @param checkIcon a check icon</b>
<b class="nc"><i>528</i>&nbsp;     * @param arrowIcon an arrow icon</b>
<b class="nc"><i>529</i>&nbsp;     * @param defaultTextIconGap a gap between a text and an icon</b>
<b class="nc"><i>530</i>&nbsp;     * @return the preferred size of a menu item</b>
<b class="nc"><i>531</i>&nbsp;     */</b>
<i>532</i>&nbsp;    protected Dimension getPreferredMenuItemSize(JComponent c,
<b class="nc"><i>533</i>&nbsp;                                                 Icon checkIcon,</b>
<i>534</i>&nbsp;                                                 Icon arrowIcon,
<i>535</i>&nbsp;                                                 int defaultTextIconGap) {
<b class="nc"><i>536</i>&nbsp;</b>
<i>537</i>&nbsp;        // The method also determines the preferred width of the
<i>538</i>&nbsp;        // parent popup menu (through DefaultMenuLayout class).
<b class="nc"><i>539</i>&nbsp;        // The menu width equals to the maximal width</b>
<b class="nc"><i>540</i>&nbsp;        // among child menu items.</b>
<b class="nc"><i>541</i>&nbsp;</b>
<b class="nc"><i>542</i>&nbsp;        // Menu item width will be a sum of the widest check icon, label,</b>
<i>543</i>&nbsp;        // arrow icon and accelerator text among neighbor menu items.
<i>544</i>&nbsp;        // For the latest menu item we will know the maximal widths exactly.
<i>545</i>&nbsp;        // It will be the widest menu item and it will determine
<i>546</i>&nbsp;        // the width of the parent popup menu.
<i>547</i>&nbsp;
<i>548</i>&nbsp;        // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
<i>549</i>&nbsp;        // There is a conceptual problem: if user sets preferred size manually
<b class="nc"><i>550</i>&nbsp;        // for a menu item, this method won&#39;t be called for it</b>
<b class="nc"><i>551</i>&nbsp;        // (see JComponent.getPreferredSize()),</b>
<b class="nc"><i>552</i>&nbsp;        // maximal widths won&#39;t be calculated, other menu items won&#39;t be able</b>
<b class="nc"><i>553</i>&nbsp;        // to take them into account and will be layouted in such a way,</b>
<b class="nc"><i>554</i>&nbsp;        // as there is no the item with manual preferred size.</b>
<i>555</i>&nbsp;        // But after the first paint() method call, all maximal widths
<b class="nc"><i>556</i>&nbsp;        // will be correctly calculated and layout of some menu items</b>
<i>557</i>&nbsp;        // can be changed. For example, it can cause a shift of
<b class="nc"><i>558</i>&nbsp;        // the icon and text when user points a menu item by mouse.</b>
<b class="nc"><i>559</i>&nbsp;</b>
<b class="nc"><i>560</i>&nbsp;        JMenuItem mi = (JMenuItem) c;</b>
<i>561</i>&nbsp;        MenuItemLayoutHelper lh = new MenuItemLayoutHelper(mi, checkIcon,
<b class="nc"><i>562</i>&nbsp;                arrowIcon, MenuItemLayoutHelper.createMaxRect(), defaultTextIconGap,</b>
<i>563</i>&nbsp;                acceleratorDelimiter, BasicGraphicsUtils.isLeftToRight(mi),
<i>564</i>&nbsp;                mi.getFont(), acceleratorFont,
<i>565</i>&nbsp;                MenuItemLayoutHelper.useCheckAndArrow(menuItem),
<i>566</i>&nbsp;                getPropertyPrefix());
<i>567</i>&nbsp;
<b class="nc"><i>568</i>&nbsp;        Dimension result = new Dimension();</b>
<b class="nc"><i>569</i>&nbsp;</b>
<b class="nc"><i>570</i>&nbsp;        // Calculate the result width</b>
<b class="nc"><i>571</i>&nbsp;        result.width = lh.getLeadingGap();</b>
<i>572</i>&nbsp;        MenuItemLayoutHelper.addMaxWidth(lh.getCheckSize(),
<b class="nc"><i>573</i>&nbsp;                lh.getAfterCheckIconGap(), result);</b>
<b class="nc"><i>574</i>&nbsp;        // Take into account mimimal text offset.</b>
<b class="nc"><i>575</i>&nbsp;        if ((!lh.isTopLevelMenu())</b>
<b class="nc"><i>576</i>&nbsp;                &amp;&amp; (lh.getMinTextOffset() &gt; 0)</b>
<b class="nc"><i>577</i>&nbsp;                &amp;&amp; (result.width &lt; lh.getMinTextOffset())) {</b>
<i>578</i>&nbsp;            result.width = lh.getMinTextOffset();
<b class="nc"><i>579</i>&nbsp;        }</b>
<b class="nc"><i>580</i>&nbsp;        MenuItemLayoutHelper.addMaxWidth(lh.getLabelSize(), lh.getGap(), result);</b>
<b class="nc"><i>581</i>&nbsp;        MenuItemLayoutHelper.addMaxWidth(lh.getAccSize(), lh.getGap(), result);</b>
<b class="nc"><i>582</i>&nbsp;        MenuItemLayoutHelper.addMaxWidth(lh.getArrowSize(), lh.getGap(), result);</b>
<b class="nc"><i>583</i>&nbsp;</b>
<b class="nc"><i>584</i>&nbsp;        // Calculate the result height</b>
<b class="nc"><i>585</i>&nbsp;        result.height = MenuItemLayoutHelper.max(lh.getCheckSize().getHeight(),</b>
<b class="nc"><i>586</i>&nbsp;                lh.getLabelSize().getHeight(), lh.getAccSize().getHeight(),</b>
<i>587</i>&nbsp;                lh.getArrowSize().getHeight());
<i>588</i>&nbsp;
<i>589</i>&nbsp;        // Take into account menu item insets
<b class="nc"><i>590</i>&nbsp;        Insets insets = lh.getMenuItem().getInsets();</b>
<b class="nc"><i>591</i>&nbsp;        if(insets != null) {</b>
<b class="nc"><i>592</i>&nbsp;            result.width += insets.left + insets.right;</b>
<b class="nc"><i>593</i>&nbsp;            result.height += insets.top + insets.bottom;</b>
<i>594</i>&nbsp;        }
<b class="nc"><i>595</i>&nbsp;</b>
<i>596</i>&nbsp;        // if the width is even, bump it up one. This is critical
<b class="nc"><i>597</i>&nbsp;        // for the focus dash line to draw properly</b>
<b class="nc"><i>598</i>&nbsp;        if(result.width%2 == 0) {</b>
<b class="nc"><i>599</i>&nbsp;            result.width++;</b>
<i>600</i>&nbsp;        }
<i>601</i>&nbsp;
<i>602</i>&nbsp;        // if the height is even, bump it up one. This is critical
<i>603</i>&nbsp;        // for the text to center properly
<i>604</i>&nbsp;        if(result.height%2 == 0
<i>605</i>&nbsp;                &amp;&amp; Boolean.TRUE !=
<b class="nc"><i>606</i>&nbsp;                    UIManager.get(getPropertyPrefix() + &quot;.evenHeight&quot;)) {</b>
<b class="nc"><i>607</i>&nbsp;            result.height++;</b>
<i>608</i>&nbsp;        }
<b class="nc"><i>609</i>&nbsp;</b>
<i>610</i>&nbsp;        return result;
<i>611</i>&nbsp;    }
<b class="nc"><i>612</i>&nbsp;</b>
<i>613</i>&nbsp;    /**
<i>614</i>&nbsp;     * We draw the background in paintMenuItem()
<i>615</i>&nbsp;     * so override update (which fills the background of opaque
<i>616</i>&nbsp;     * components by default) to just call paint().
<i>617</i>&nbsp;     *
<i>618</i>&nbsp;     */
<i>619</i>&nbsp;    public void update(Graphics g, JComponent c) {
<b class="nc"><i>620</i>&nbsp;        paint(g, c);</b>
<b class="nc"><i>621</i>&nbsp;    }</b>
<b class="nc"><i>622</i>&nbsp;</b>
<b class="nc"><i>623</i>&nbsp;    public void paint(Graphics g, JComponent c) {</b>
<b class="nc"><i>624</i>&nbsp;        paintMenuItem(g, c, checkIcon, arrowIcon,</b>
<i>625</i>&nbsp;                      selectionBackground, selectionForeground,
<b class="nc"><i>626</i>&nbsp;                      defaultTextIconGap);</b>
<b class="nc"><i>627</i>&nbsp;    }</b>
<b class="nc"><i>628</i>&nbsp;</b>
<i>629</i>&nbsp;    /**
<i>630</i>&nbsp;     * Paints a menu item.
<i>631</i>&nbsp;     *
<i>632</i>&nbsp;     * @param g an instance of {@code Graphics}
<i>633</i>&nbsp;     * @param c a component
<b class="nc"><i>634</i>&nbsp;     * @param checkIcon a check icon</b>
<b class="nc"><i>635</i>&nbsp;     * @param arrowIcon an arrow icon</b>
<b class="nc"><i>636</i>&nbsp;     * @param background a background color</b>
<b class="nc"><i>637</i>&nbsp;     * @param foreground a foreground color</b>
<b class="nc"><i>638</i>&nbsp;     * @param defaultTextIconGap a gap between a text and an icon</b>
<i>639</i>&nbsp;     */
<i>640</i>&nbsp;    protected void paintMenuItem(Graphics g, JComponent c,
<i>641</i>&nbsp;                                     Icon checkIcon, Icon arrowIcon,
<i>642</i>&nbsp;                                     Color background, Color foreground,
<i>643</i>&nbsp;                                     int defaultTextIconGap) {
<i>644</i>&nbsp;        // Save original graphics font and color
<i>645</i>&nbsp;        Font holdf = g.getFont();
<i>646</i>&nbsp;        Color holdc = g.getColor();
<i>647</i>&nbsp;
<i>648</i>&nbsp;        JMenuItem mi = (JMenuItem) c;
<i>649</i>&nbsp;        g.setFont(mi.getFont());
<i>650</i>&nbsp;
<b class="nc"><i>651</i>&nbsp;        Rectangle viewRect = new Rectangle(0, 0, mi.getWidth(), mi.getHeight());</b>
<b class="nc"><i>652</i>&nbsp;        applyInsets(viewRect, mi.getInsets());</b>
<b class="nc"><i>653</i>&nbsp;</b>
<b class="nc"><i>654</i>&nbsp;        MenuItemLayoutHelper lh = new MenuItemLayoutHelper(mi, checkIcon,</b>
<i>655</i>&nbsp;                arrowIcon, viewRect, defaultTextIconGap, acceleratorDelimiter,
<b class="nc"><i>656</i>&nbsp;                BasicGraphicsUtils.isLeftToRight(mi), mi.getFont(),</b>
<b class="nc"><i>657</i>&nbsp;                acceleratorFont, MenuItemLayoutHelper.useCheckAndArrow(menuItem),</b>
<b class="nc"><i>658</i>&nbsp;                getPropertyPrefix());</b>
<b class="nc"><i>659</i>&nbsp;        MenuItemLayoutHelper.LayoutResult lr = lh.layoutMenuItem();</b>
<i>660</i>&nbsp;
<b class="nc"><i>661</i>&nbsp;        paintBackground(g, mi, background);</b>
<b class="nc"><i>662</i>&nbsp;        paintCheckIcon(g, lh, lr, holdc, foreground);</b>
<i>663</i>&nbsp;        paintIcon(g, lh, lr, holdc);
<b class="nc"><i>664</i>&nbsp;        paintText(g, lh, lr);</b>
<i>665</i>&nbsp;        paintAccText(g, lh, lr);
<b class="nc"><i>666</i>&nbsp;        paintArrowIcon(g, lh, lr, foreground);</b>
<b class="nc"><i>667</i>&nbsp;</b>
<b class="nc"><i>668</i>&nbsp;        // Restore original graphics font and color</b>
<b class="nc"><i>669</i>&nbsp;        g.setColor(holdc);</b>
<b class="nc"><i>670</i>&nbsp;        g.setFont(holdf);</b>
<i>671</i>&nbsp;    }
<i>672</i>&nbsp;
<i>673</i>&nbsp;    private void paintIcon(Graphics g, MenuItemLayoutHelper lh,
<i>674</i>&nbsp;                           MenuItemLayoutHelper.LayoutResult lr, Color holdc) {
<i>675</i>&nbsp;        if (lh.getIcon() != null) {
<i>676</i>&nbsp;            Icon icon;
<i>677</i>&nbsp;            ButtonModel model = lh.getMenuItem().getModel();
<i>678</i>&nbsp;            if (!model.isEnabled()) {
<i>679</i>&nbsp;                icon = lh.getMenuItem().getDisabledIcon();
<i>680</i>&nbsp;            } else if (model.isPressed() &amp;&amp; model.isArmed()) {
<i>681</i>&nbsp;                icon = lh.getMenuItem().getPressedIcon();
<i>682</i>&nbsp;                if (icon == null) {
<i>683</i>&nbsp;                    // Use default icon
<b class="nc"><i>684</i>&nbsp;                    icon = lh.getMenuItem().getIcon();</b>
<b class="nc"><i>685</i>&nbsp;                }</b>
<b class="nc"><i>686</i>&nbsp;            } else {</b>
<i>687</i>&nbsp;                icon = lh.getMenuItem().getIcon();
<b class="nc"><i>688</i>&nbsp;            }</b>
<i>689</i>&nbsp;
<b class="nc"><i>690</i>&nbsp;            if (icon != null) {</b>
<b class="nc"><i>691</i>&nbsp;                icon.paintIcon(lh.getMenuItem(), g, lr.getIconRect().x,</b>
<b class="nc"><i>692</i>&nbsp;                        lr.getIconRect().y);</b>
<b class="nc"><i>693</i>&nbsp;                g.setColor(holdc);</b>
<i>694</i>&nbsp;            }
<b class="nc"><i>695</i>&nbsp;        }</b>
<b class="nc"><i>696</i>&nbsp;    }</b>
<b class="nc"><i>697</i>&nbsp;</b>
<b class="nc"><i>698</i>&nbsp;    private void paintCheckIcon(Graphics g, MenuItemLayoutHelper lh,</b>
<b class="nc"><i>699</i>&nbsp;                                MenuItemLayoutHelper.LayoutResult lr,</b>
<i>700</i>&nbsp;                                Color holdc, Color foreground) {
<b class="nc"><i>701</i>&nbsp;        if (lh.getCheckIcon() != null) {</b>
<i>702</i>&nbsp;            ButtonModel model = lh.getMenuItem().getModel();
<i>703</i>&nbsp;            if (model.isArmed() || (lh.getMenuItem() instanceof JMenu
<i>704</i>&nbsp;                    &amp;&amp; model.isSelected())) {
<b class="nc"><i>705</i>&nbsp;                g.setColor(foreground);</b>
<b class="nc"><i>706</i>&nbsp;            } else {</b>
<i>707</i>&nbsp;                g.setColor(holdc);
<b class="nc"><i>708</i>&nbsp;            }</b>
<b class="nc"><i>709</i>&nbsp;            if (lh.useCheckAndArrow()) {</b>
<i>710</i>&nbsp;                lh.getCheckIcon().paintIcon(lh.getMenuItem(), g,
<i>711</i>&nbsp;                        lr.getCheckRect().x, lr.getCheckRect().y);
<i>712</i>&nbsp;            }
<i>713</i>&nbsp;            g.setColor(holdc);
<b class="nc"><i>714</i>&nbsp;        }</b>
<b class="nc"><i>715</i>&nbsp;    }</b>
<i>716</i>&nbsp;
<b class="nc"><i>717</i>&nbsp;    private void paintAccText(Graphics g, MenuItemLayoutHelper lh,</b>
<b class="nc"><i>718</i>&nbsp;                              MenuItemLayoutHelper.LayoutResult lr) {</b>
<b class="nc"><i>719</i>&nbsp;        if (!lh.getAccText().equals(&quot;&quot;)) {</b>
<b class="nc"><i>720</i>&nbsp;            ButtonModel model = lh.getMenuItem().getModel();</b>
<b class="nc"><i>721</i>&nbsp;            g.setFont(lh.getAccFontMetrics().getFont());</b>
<i>722</i>&nbsp;            if (!model.isEnabled()) {
<b class="nc"><i>723</i>&nbsp;                // *** paint the accText disabled</b>
<b class="nc"><i>724</i>&nbsp;                if (disabledForeground != null) {</b>
<b class="nc"><i>725</i>&nbsp;                    g.setColor(disabledForeground);</b>
<i>726</i>&nbsp;                    SwingUtilities2.drawString(lh.getMenuItem(), g,
<i>727</i>&nbsp;                        lh.getAccText(), lr.getAccRect().x,
<i>728</i>&nbsp;                        lr.getAccRect().y + lh.getAccFontMetrics().getAscent());
<i>729</i>&nbsp;                } else {
<i>730</i>&nbsp;                    g.setColor(lh.getMenuItem().getBackground().brighter());
<i>731</i>&nbsp;                    SwingUtilities2.drawString(lh.getMenuItem(), g,
<i>732</i>&nbsp;                        lh.getAccText(), lr.getAccRect().x,
<i>733</i>&nbsp;                        lr.getAccRect().y + lh.getAccFontMetrics().getAscent());
<b class="nc"><i>734</i>&nbsp;                    g.setColor(lh.getMenuItem().getBackground().darker());</b>
<b class="nc"><i>735</i>&nbsp;                    SwingUtilities2.drawString(lh.getMenuItem(), g,</b>
<b class="nc"><i>736</i>&nbsp;                        lh.getAccText(), lr.getAccRect().x - 1,</b>
<i>737</i>&nbsp;                        lr.getAccRect().y + lh.getFontMetrics().getAscent() - 1);
<b class="nc"><i>738</i>&nbsp;                }</b>
<b class="nc"><i>739</i>&nbsp;            } else {</b>
<b class="nc"><i>740</i>&nbsp;                // *** paint the accText normally</b>
<i>741</i>&nbsp;                if (model.isArmed()
<i>742</i>&nbsp;                        || (lh.getMenuItem() instanceof JMenu
<i>743</i>&nbsp;                        &amp;&amp; model.isSelected())) {
<i>744</i>&nbsp;                    g.setColor(acceleratorSelectionForeground);
<i>745</i>&nbsp;                } else {
<i>746</i>&nbsp;                    g.setColor(acceleratorForeground);
<i>747</i>&nbsp;                }
<i>748</i>&nbsp;                SwingUtilities2.drawString(lh.getMenuItem(), g, lh.getAccText(),
<b class="nc"><i>749</i>&nbsp;                        lr.getAccRect().x, lr.getAccRect().y +</b>
<i>750</i>&nbsp;                        lh.getAccFontMetrics().getAscent());
<i>751</i>&nbsp;            }
<i>752</i>&nbsp;        }
<b class="nc"><i>753</i>&nbsp;    }</b>
<i>754</i>&nbsp;
<b class="nc"><i>755</i>&nbsp;    private void paintText(Graphics g, MenuItemLayoutHelper lh,</b>
<b class="nc"><i>756</i>&nbsp;                           MenuItemLayoutHelper.LayoutResult lr) {</b>
<b class="nc"><i>757</i>&nbsp;        if (!lh.getText().equals(&quot;&quot;)) {</b>
<b class="nc"><i>758</i>&nbsp;            if (lh.getHtmlView() != null) {</b>
<b class="nc"><i>759</i>&nbsp;                // Text is HTML</b>
<b class="nc"><i>760</i>&nbsp;                lh.getHtmlView().paint(g, lr.getTextRect());</b>
<b class="nc"><i>761</i>&nbsp;            } else {</b>
<b class="nc"><i>762</i>&nbsp;                // Text isn&#39;t HTML</b>
<i>763</i>&nbsp;                paintText(g, lh.getMenuItem(), lr.getTextRect(), lh.getText());
<b class="nc"><i>764</i>&nbsp;            }</b>
<i>765</i>&nbsp;        }
<b class="nc"><i>766</i>&nbsp;    }</b>
<i>767</i>&nbsp;
<b class="nc"><i>768</i>&nbsp;    private void paintArrowIcon(Graphics g, MenuItemLayoutHelper lh,</b>
<b class="nc"><i>769</i>&nbsp;                                MenuItemLayoutHelper.LayoutResult lr,</b>
<i>770</i>&nbsp;                                Color foreground) {
<b class="nc"><i>771</i>&nbsp;        if (lh.getArrowIcon() != null) {</b>
<i>772</i>&nbsp;            ButtonModel model = lh.getMenuItem().getModel();
<i>773</i>&nbsp;            if (model.isArmed() || (lh.getMenuItem() instanceof JMenu
<i>774</i>&nbsp;                                &amp;&amp; model.isSelected())) {
<i>775</i>&nbsp;                g.setColor(foreground);
<i>776</i>&nbsp;            }
<i>777</i>&nbsp;            if (lh.useCheckAndArrow()) {
<b class="nc"><i>778</i>&nbsp;                lh.getArrowIcon().paintIcon(lh.getMenuItem(), g,</b>
<i>779</i>&nbsp;                        lr.getArrowRect().x, lr.getArrowRect().y);
<i>780</i>&nbsp;            }
<b class="nc"><i>781</i>&nbsp;        }</b>
<i>782</i>&nbsp;    }
<i>783</i>&nbsp;
<b class="nc"><i>784</i>&nbsp;    private void applyInsets(Rectangle rect, Insets insets) {</b>
<i>785</i>&nbsp;        if(insets != null) {
<i>786</i>&nbsp;            rect.x += insets.left;
<b class="nc"><i>787</i>&nbsp;            rect.y += insets.top;</b>
<i>788</i>&nbsp;            rect.width -= (insets.right + rect.x);
<i>789</i>&nbsp;            rect.height -= (insets.bottom + rect.y);
<b class="nc"><i>790</i>&nbsp;        }</b>
<i>791</i>&nbsp;    }
<i>792</i>&nbsp;
<b class="nc"><i>793</i>&nbsp;    /**</b>
<i>794</i>&nbsp;     * Draws the background of the menu item.
<i>795</i>&nbsp;     *
<b class="nc"><i>796</i>&nbsp;     * @param g the paint graphics</b>
<i>797</i>&nbsp;     * @param menuItem menu item to be painted
<i>798</i>&nbsp;     * @param bgColor selection background color
<i>799</i>&nbsp;     * @since 1.4
<i>800</i>&nbsp;     */
<i>801</i>&nbsp;    protected void paintBackground(Graphics g, JMenuItem menuItem, Color bgColor) {
<i>802</i>&nbsp;        ButtonModel model = menuItem.getModel();
<i>803</i>&nbsp;        Color oldColor = g.getColor();
<i>804</i>&nbsp;        int menuWidth = menuItem.getWidth();
<b class="nc"><i>805</i>&nbsp;        int menuHeight = menuItem.getHeight();</b>
<i>806</i>&nbsp;
<i>807</i>&nbsp;        if(menuItem.isOpaque()) {
<i>808</i>&nbsp;            if (model.isArmed()|| (menuItem instanceof JMenu &amp;&amp; model.isSelected())) {
<b class="nc"><i>809</i>&nbsp;                g.setColor(bgColor);</b>
<b class="nc"><i>810</i>&nbsp;                g.fillRect(0,0, menuWidth, menuHeight);</b>
<b class="nc"><i>811</i>&nbsp;            } else {</b>
<i>812</i>&nbsp;                g.setColor(menuItem.getBackground());
<i>813</i>&nbsp;                g.fillRect(0,0, menuWidth, menuHeight);
<i>814</i>&nbsp;            }
<i>815</i>&nbsp;            g.setColor(oldColor);
<i>816</i>&nbsp;        }
<i>817</i>&nbsp;        else if (model.isArmed() || (menuItem instanceof JMenu &amp;&amp;
<i>818</i>&nbsp;                                     model.isSelected())) {
<i>819</i>&nbsp;            g.setColor(bgColor);
<i>820</i>&nbsp;            g.fillRect(0,0, menuWidth, menuHeight);
<i>821</i>&nbsp;            g.setColor(oldColor);
<i>822</i>&nbsp;        }
<i>823</i>&nbsp;    }
<i>824</i>&nbsp;
<i>825</i>&nbsp;    /**
<i>826</i>&nbsp;     * Renders the text of the current menu item.
<i>827</i>&nbsp;     *
<i>828</i>&nbsp;     * @param g graphics context
<i>829</i>&nbsp;     * @param menuItem menu item to render
<i>830</i>&nbsp;     * @param textRect bounding rectangle for rendering the text
<i>831</i>&nbsp;     * @param text string to render
<i>832</i>&nbsp;     * @since 1.4
<b class="nc"><i>833</i>&nbsp;     */</b>
<b class="nc"><i>834</i>&nbsp;    protected void paintText(Graphics g, JMenuItem menuItem, Rectangle textRect, String text) {</b>
<i>835</i>&nbsp;        ButtonModel model = menuItem.getModel();
<i>836</i>&nbsp;        FontMetrics fm = SwingUtilities2.getFontMetrics(menuItem, g);
<i>837</i>&nbsp;        int mnemIndex = menuItem.getDisplayedMnemonicIndex();
<b class="nc"><i>838</i>&nbsp;</b>
<b class="nc"><i>839</i>&nbsp;        if(!model.isEnabled()) {</b>
<i>840</i>&nbsp;            // *** paint the text disabled
<b class="nc"><i>841</i>&nbsp;            if ( UIManager.get(&quot;MenuItem.disabledForeground&quot;) instanceof Color ) {</b>
<b class="nc"><i>842</i>&nbsp;                g.setColor( UIManager.getColor(&quot;MenuItem.disabledForeground&quot;) );</b>
<i>843</i>&nbsp;                SwingUtilities2.drawStringUnderlineCharAt(menuItem, g,text,
<i>844</i>&nbsp;                          mnemIndex, textRect.x,  textRect.y + fm.getAscent());
<i>845</i>&nbsp;            } else {
<i>846</i>&nbsp;                g.setColor(menuItem.getBackground().brighter());
<i>847</i>&nbsp;                SwingUtilities2.drawStringUnderlineCharAt(menuItem, g, text,
<i>848</i>&nbsp;                           mnemIndex, textRect.x, textRect.y + fm.getAscent());
<i>849</i>&nbsp;                g.setColor(menuItem.getBackground().darker());
<i>850</i>&nbsp;                SwingUtilities2.drawStringUnderlineCharAt(menuItem, g,text,
<i>851</i>&nbsp;                           mnemIndex,  textRect.x - 1, textRect.y +
<i>852</i>&nbsp;                           fm.getAscent() - 1);
<i>853</i>&nbsp;            }
<i>854</i>&nbsp;        } else {
<i>855</i>&nbsp;            // *** paint the text normally
<b class="nc"><i>856</i>&nbsp;            if (model.isArmed()|| (menuItem instanceof JMenu &amp;&amp; model.isSelected())) {</b>
<b class="nc"><i>857</i>&nbsp;                g.setColor(selectionForeground); // Uses protected field.</b>
<i>858</i>&nbsp;            }
<i>859</i>&nbsp;            SwingUtilities2.drawStringUnderlineCharAt(menuItem, g,text,
<i>860</i>&nbsp;                           mnemIndex, textRect.x, textRect.y + fm.getAscent());
<b class="nc"><i>861</i>&nbsp;        }</b>
<i>862</i>&nbsp;    }
<b class="nc"><i>863</i>&nbsp;</b>
<i>864</i>&nbsp;    /**
<i>865</i>&nbsp;     * Returns a menu element path.
<i>866</i>&nbsp;     *
<i>867</i>&nbsp;     * @return a menu element path
<i>868</i>&nbsp;     */
<b class="nc"><i>869</i>&nbsp;    public MenuElement[] getPath() {</b>
<i>870</i>&nbsp;        MenuSelectionManager m = MenuSelectionManager.defaultManager();
<i>871</i>&nbsp;        MenuElement oldPath[] = m.getSelectedPath();
<i>872</i>&nbsp;        MenuElement newPath[];
<i>873</i>&nbsp;        int i = oldPath.length;
<i>874</i>&nbsp;        if (i == 0)
<i>875</i>&nbsp;            return new MenuElement[0];
<i>876</i>&nbsp;        Component parent = menuItem.getParent();
<i>877</i>&nbsp;        if (oldPath[i-1].getComponent() == parent) {
<b class="nc"><i>878</i>&nbsp;            // The parent popup menu is the last so far</b>
<i>879</i>&nbsp;            newPath = new MenuElement[i+1];
<i>880</i>&nbsp;            System.arraycopy(oldPath, 0, newPath, 0, i);
<i>881</i>&nbsp;            newPath[i] = menuItem;
<b class="nc"><i>882</i>&nbsp;        } else {</b>
<b class="nc"><i>883</i>&nbsp;            // A sibling menuitem is the current selection</b>
<b class="nc"><i>884</i>&nbsp;            //</b>
<b class="nc"><i>885</i>&nbsp;            //  This probably needs to handle &#39;exit submenu into</b>
<b class="nc"><i>886</i>&nbsp;            // a menu item.  Search backwards along the current</b>
<i>887</i>&nbsp;            // selection until you find the parent popup menu,
<b class="nc"><i>888</i>&nbsp;            // then copy up to that and add yourself...</b>
<i>889</i>&nbsp;            int j;
<i>890</i>&nbsp;            for (j = oldPath.length-1; j &gt;= 0; j--) {
<i>891</i>&nbsp;                if (oldPath[j].getComponent() == parent)
<b class="nc"><i>892</i>&nbsp;                    break;</b>
<b class="nc"><i>893</i>&nbsp;            }</b>
<i>894</i>&nbsp;            newPath = new MenuElement[j+2];
<b class="nc"><i>895</i>&nbsp;            System.arraycopy(oldPath, 0, newPath, 0, j+1);</b>
<i>896</i>&nbsp;            newPath[j+1] = menuItem;
<b class="nc"><i>897</i>&nbsp;            /*</b>
<i>898</i>&nbsp;            System.out.println(&quot;Sibling condition -- &quot;);
<b class="nc"><i>899</i>&nbsp;            System.out.println(&quot;Old array : &quot;);</b>
<i>900</i>&nbsp;            printMenuElementArray(oldPath, false);
<i>901</i>&nbsp;            System.out.println(&quot;New array : &quot;);
<i>902</i>&nbsp;            printMenuElementArray(newPath, false);
<b class="nc"><i>903</i>&nbsp;            */</b>
<i>904</i>&nbsp;        }
<b class="nc"><i>905</i>&nbsp;        return newPath;</b>
<i>906</i>&nbsp;    }
<b class="nc"><i>907</i>&nbsp;</b>
<i>908</i>&nbsp;    void printMenuElementArray(MenuElement path[], boolean dumpStack) {
<b class="nc"><i>909</i>&nbsp;        System.out.println(&quot;Path is(&quot;);</b>
<i>910</i>&nbsp;        int i, j;
<i>911</i>&nbsp;        for(i=0,j=path.length; i&lt;j ;i++){
<b class="nc"><i>912</i>&nbsp;            for (int k=0; k&lt;=i; k++)</b>
<b class="nc"><i>913</i>&nbsp;                System.out.print(&quot;  &quot;);</b>
<b class="nc"><i>914</i>&nbsp;            MenuElement me = path[i];</b>
<i>915</i>&nbsp;            if(me instanceof JMenuItem)
<b class="nc"><i>916</i>&nbsp;                System.out.println(((JMenuItem)me).getText() + &quot;, &quot;);</b>
<b class="nc"><i>917</i>&nbsp;            else if (me == null)</b>
<b class="nc"><i>918</i>&nbsp;                System.out.println(&quot;NULL , &quot;);</b>
<i>919</i>&nbsp;            else
<i>920</i>&nbsp;                System.out.println(&quot;&quot; + me + &quot;, &quot;);
<i>921</i>&nbsp;        }
<i>922</i>&nbsp;        System.out.println(&quot;)&quot;);
<i>923</i>&nbsp;
<b class="nc"><i>924</i>&nbsp;        if (dumpStack == true)</b>
<i>925</i>&nbsp;            Thread.dumpStack();
<i>926</i>&nbsp;    }
<i>927</i>&nbsp;    /** Mouse input handler */
<i>928</i>&nbsp;    protected class MouseInputHandler implements MouseInputListener {
<i>929</i>&nbsp;        // NOTE: This class exists only for backward compatibility. All
<i>930</i>&nbsp;        // its functionality has been moved into Handler. If you need to add
<i>931</i>&nbsp;        // new functionality add it to the Handler, but make sure this
<i>932</i>&nbsp;        // class calls into the Handler.
<b class="nc"><i>933</i>&nbsp;</b>
<b class="nc"><i>934</i>&nbsp;        /** {@inheritDoc} */</b>
<b class="nc"><i>935</i>&nbsp;        public void mouseClicked(MouseEvent e) {</b>
<i>936</i>&nbsp;            getHandler().mouseClicked(e);
<i>937</i>&nbsp;        }
<b class="nc"><i>938</i>&nbsp;        /** {@inheritDoc} */</b>
<b class="nc"><i>939</i>&nbsp;        public void mousePressed(MouseEvent e) {</b>
<b class="nc"><i>940</i>&nbsp;            getHandler().mousePressed(e);</b>
<i>941</i>&nbsp;        }
<i>942</i>&nbsp;        /** {@inheritDoc} */
<i>943</i>&nbsp;        public void mouseReleased(MouseEvent e) {
<b class="nc"><i>944</i>&nbsp;            getHandler().mouseReleased(e);</b>
<i>945</i>&nbsp;        }
<i>946</i>&nbsp;        /** {@inheritDoc} */
<b class="nc"><i>947</i>&nbsp;        public void mouseEntered(MouseEvent e) {</b>
<b class="nc"><i>948</i>&nbsp;            getHandler().mouseEntered(e);</b>
<b class="nc"><i>949</i>&nbsp;        }</b>
<b class="nc"><i>950</i>&nbsp;        /** {@inheritDoc} */</b>
<b class="nc"><i>951</i>&nbsp;        public void mouseExited(MouseEvent e) {</b>
<b class="nc"><i>952</i>&nbsp;            getHandler().mouseExited(e);</b>
<i>953</i>&nbsp;        }
<b class="nc"><i>954</i>&nbsp;        /** {@inheritDoc} */</b>
<i>955</i>&nbsp;        public void mouseDragged(MouseEvent e) {
<i>956</i>&nbsp;            getHandler().mouseDragged(e);
<i>957</i>&nbsp;        }
<i>958</i>&nbsp;        /** {@inheritDoc} */
<i>959</i>&nbsp;        public void mouseMoved(MouseEvent e) {
<i>960</i>&nbsp;            getHandler().mouseMoved(e);
<i>961</i>&nbsp;        }
<i>962</i>&nbsp;    }
<b class="nc"><i>963</i>&nbsp;</b>
<i>964</i>&nbsp;
<b class="nc"><i>965</i>&nbsp;    private static class Actions extends UIAction {</b>
<i>966</i>&nbsp;        private static final String CLICK = &quot;doClick&quot;;
<b class="nc"><i>967</i>&nbsp;</b>
<b class="nc"><i>968</i>&nbsp;        Actions(String key) {</b>
<i>969</i>&nbsp;            super(key);
<i>970</i>&nbsp;        }
<i>971</i>&nbsp;
<i>972</i>&nbsp;        public void actionPerformed(ActionEvent e) {
<b class="nc"><i>973</i>&nbsp;            JMenuItem mi = (JMenuItem)e.getSource();</b>
<b class="nc"><i>974</i>&nbsp;            MenuSelectionManager.defaultManager().clearSelectedPath();</b>
<b class="nc"><i>975</i>&nbsp;            mi.doClick();</b>
<b class="nc"><i>976</i>&nbsp;        }</b>
<b class="nc"><i>977</i>&nbsp;    }</b>
<b class="nc"><i>978</i>&nbsp;</b>
<b class="nc"><i>979</i>&nbsp;    boolean doNotCloseOnMouseClick() {</b>
<i>980</i>&nbsp;        if (menuItem instanceof JCheckBoxMenuItem) {
<i>981</i>&nbsp;            String property = &quot;CheckBoxMenuItem.doNotCloseOnMouseClick&quot;;
<i>982</i>&nbsp;            return SwingUtilities2.getBoolean(menuItem, property);
<i>983</i>&nbsp;        } else if (menuItem instanceof JRadioButtonMenuItem) {
<i>984</i>&nbsp;            String property = &quot;RadioButtonMenuItem.doNotCloseOnMouseClick&quot;;
<i>985</i>&nbsp;            return SwingUtilities2.getBoolean(menuItem, property);
<i>986</i>&nbsp;        }
<i>987</i>&nbsp;        return false;
<i>988</i>&nbsp;    }
<i>989</i>&nbsp;
<i>990</i>&nbsp;    /**
<i>991</i>&nbsp;     * Call this method when a menu item is to be activated.
<i>992</i>&nbsp;     * This method handles some of the details of menu item activation
<i>993</i>&nbsp;     * such as clearing the selected path and messaging the
<i>994</i>&nbsp;     * JMenuItem&#39;s doClick() method.
<i>995</i>&nbsp;     *
<i>996</i>&nbsp;     * @param msm  A MenuSelectionManager. The visual feedback and
<i>997</i>&nbsp;     *             internal bookkeeping tasks are delegated to
<i>998</i>&nbsp;     *             this MenuSelectionManager. If &lt;code&gt;null&lt;/code&gt; is
<i>999</i>&nbsp;     *             passed as this argument, the
<i>1000</i>&nbsp;     *             &lt;code&gt;MenuSelectionManager.defaultManager&lt;/code&gt; is
<i>1001</i>&nbsp;     *             used.
<i>1002</i>&nbsp;     * @see MenuSelectionManager
<i>1003</i>&nbsp;     * @see JMenuItem#doClick(int)
<i>1004</i>&nbsp;     * @since 1.4
<i>1005</i>&nbsp;     */
<i>1006</i>&nbsp;    protected void doClick(MenuSelectionManager msm) {
<i>1007</i>&nbsp;        // Auditory cue
<i>1008</i>&nbsp;        if (! isInternalFrameSystemMenu()) {
<i>1009</i>&nbsp;            BasicLookAndFeel.playSound(menuItem, getPropertyPrefix() +
<i>1010</i>&nbsp;                                       &quot;.commandSound&quot;);
<i>1011</i>&nbsp;        }
<i>1012</i>&nbsp;        if (!doNotCloseOnMouseClick()) {
<i>1013</i>&nbsp;            // Visual feedback
<i>1014</i>&nbsp;            if (msm == null) {
<i>1015</i>&nbsp;                msm = MenuSelectionManager.defaultManager();
<i>1016</i>&nbsp;            }
<i>1017</i>&nbsp;
<i>1018</i>&nbsp;            msm.clearSelectedPath();
<i>1019</i>&nbsp;        }
<i>1020</i>&nbsp;        menuItem.doClick(0);
<i>1021</i>&nbsp;    }
<i>1022</i>&nbsp;
<i>1023</i>&nbsp;    /**
<i>1024</i>&nbsp;     * This is to see if the menu item in question is part of the
<i>1025</i>&nbsp;     * system menu on an internal frame.
<i>1026</i>&nbsp;     * The Strings that are being checked can be found in
<i>1027</i>&nbsp;     * MetalInternalFrameTitlePaneUI.java,
<i>1028</i>&nbsp;     * WindowsInternalFrameTitlePaneUI.java, and
<i>1029</i>&nbsp;     * MotifInternalFrameTitlePaneUI.java.
<i>1030</i>&nbsp;     *
<i>1031</i>&nbsp;     * @since 1.4
<i>1032</i>&nbsp;     */
<i>1033</i>&nbsp;    private boolean isInternalFrameSystemMenu() {
<i>1034</i>&nbsp;        String actionCommand = menuItem.getActionCommand();
<i>1035</i>&nbsp;        if ((actionCommand == &quot;Close&quot;) ||
<i>1036</i>&nbsp;            (actionCommand == &quot;Minimize&quot;) ||
<i>1037</i>&nbsp;            (actionCommand == &quot;Restore&quot;) ||
<i>1038</i>&nbsp;            (actionCommand == &quot;Maximize&quot;)) {
<i>1039</i>&nbsp;          return true;
<i>1040</i>&nbsp;        } else {
<i>1041</i>&nbsp;          return false;
<i>1042</i>&nbsp;        }
<i>1043</i>&nbsp;    }
<i>1044</i>&nbsp;
<i>1045</i>&nbsp;
<i>1046</i>&nbsp;    // BasicMenuUI subclasses this.
<i>1047</i>&nbsp;    class Handler implements MenuDragMouseListener,
<i>1048</i>&nbsp;                          MouseInputListener, PropertyChangeListener {
<i>1049</i>&nbsp;        //
<i>1050</i>&nbsp;        // MouseInputListener
<i>1051</i>&nbsp;        //
<i>1052</i>&nbsp;        public void mouseClicked(MouseEvent e) {}
<i>1053</i>&nbsp;        public void mousePressed(MouseEvent e) {
<i>1054</i>&nbsp;        }
<i>1055</i>&nbsp;        public void mouseReleased(MouseEvent e) {
<i>1056</i>&nbsp;            if (!menuItem.isEnabled()) {
<i>1057</i>&nbsp;                return;
<i>1058</i>&nbsp;            }
<i>1059</i>&nbsp;            MenuSelectionManager manager =
<i>1060</i>&nbsp;                MenuSelectionManager.defaultManager();
<i>1061</i>&nbsp;            Point p = e.getPoint();
<i>1062</i>&nbsp;            if(p.x &gt;= 0 &amp;&amp; p.x &lt; menuItem.getWidth() &amp;&amp;
<i>1063</i>&nbsp;               p.y &gt;= 0 &amp;&amp; p.y &lt; menuItem.getHeight()) {
<i>1064</i>&nbsp;                doClick(manager);
<i>1065</i>&nbsp;            } else {
<i>1066</i>&nbsp;                manager.processMouseEvent(e);
<i>1067</i>&nbsp;            }
<i>1068</i>&nbsp;        }
<i>1069</i>&nbsp;        @SuppressWarnings(&quot;deprecation&quot;)
<i>1070</i>&nbsp;        public void mouseEntered(MouseEvent e) {
<i>1071</i>&nbsp;            MenuSelectionManager manager = MenuSelectionManager.defaultManager();
<i>1072</i>&nbsp;            int modifiers = e.getModifiers();
<i>1073</i>&nbsp;            // 4188027: drag enter/exit added in JDK 1.1.7A, JDK1.2
<i>1074</i>&nbsp;            if ((modifiers &amp; (InputEvent.BUTTON1_MASK |
<i>1075</i>&nbsp;                              InputEvent.BUTTON2_MASK | InputEvent.BUTTON3_MASK)) !=0 ) {
<i>1076</i>&nbsp;                MenuSelectionManager.defaultManager().processMouseEvent(e);
<i>1077</i>&nbsp;            } else {
<i>1078</i>&nbsp;            manager.setSelectedPath(getPath());
<i>1079</i>&nbsp;             }
<i>1080</i>&nbsp;        }
<i>1081</i>&nbsp;        @SuppressWarnings(&quot;deprecation&quot;)
<i>1082</i>&nbsp;        public void mouseExited(MouseEvent e) {
<i>1083</i>&nbsp;            MenuSelectionManager manager = MenuSelectionManager.defaultManager();
<i>1084</i>&nbsp;
<i>1085</i>&nbsp;            int modifiers = e.getModifiers();
<i>1086</i>&nbsp;            // 4188027: drag enter/exit added in JDK 1.1.7A, JDK1.2
<i>1087</i>&nbsp;            if ((modifiers &amp; (InputEvent.BUTTON1_MASK |
<i>1088</i>&nbsp;                              InputEvent.BUTTON2_MASK | InputEvent.BUTTON3_MASK)) !=0 ) {
<i>1089</i>&nbsp;                MenuSelectionManager.defaultManager().processMouseEvent(e);
<i>1090</i>&nbsp;            } else {
<i>1091</i>&nbsp;
<i>1092</i>&nbsp;                MenuElement path[] = manager.getSelectedPath();
<i>1093</i>&nbsp;                if (path.length &gt; 1 &amp;&amp; path[path.length-1] == menuItem) {
<i>1094</i>&nbsp;                    MenuElement newPath[] = new MenuElement[path.length-1];
<i>1095</i>&nbsp;                    int i,c;
<i>1096</i>&nbsp;                    for(i=0,c=path.length-1;i&lt;c;i++)
<i>1097</i>&nbsp;                        newPath[i] = path[i];
<i>1098</i>&nbsp;                    manager.setSelectedPath(newPath);
<i>1099</i>&nbsp;                }
<i>1100</i>&nbsp;                }
<i>1101</i>&nbsp;        }
<i>1102</i>&nbsp;
<i>1103</i>&nbsp;        public void mouseDragged(MouseEvent e) {
<i>1104</i>&nbsp;            MenuSelectionManager.defaultManager().processMouseEvent(e);
<i>1105</i>&nbsp;        }
<i>1106</i>&nbsp;        public void mouseMoved(MouseEvent e) {
<i>1107</i>&nbsp;        }
<i>1108</i>&nbsp;
<i>1109</i>&nbsp;        //
<i>1110</i>&nbsp;        // MenuDragListener
<i>1111</i>&nbsp;        //
<i>1112</i>&nbsp;        public void menuDragMouseEntered(MenuDragMouseEvent e) {
<i>1113</i>&nbsp;            MenuSelectionManager manager = e.getMenuSelectionManager();
<i>1114</i>&nbsp;            MenuElement path[] = e.getPath();
<i>1115</i>&nbsp;            manager.setSelectedPath(path);
<i>1116</i>&nbsp;        }
<i>1117</i>&nbsp;        public void menuDragMouseDragged(MenuDragMouseEvent e) {
<i>1118</i>&nbsp;            MenuSelectionManager manager = e.getMenuSelectionManager();
<i>1119</i>&nbsp;            MenuElement path[] = e.getPath();
<i>1120</i>&nbsp;            manager.setSelectedPath(path);
<i>1121</i>&nbsp;        }
<i>1122</i>&nbsp;        public void menuDragMouseExited(MenuDragMouseEvent e) {}
<i>1123</i>&nbsp;        public void menuDragMouseReleased(MenuDragMouseEvent e) {
<i>1124</i>&nbsp;            if (!menuItem.isEnabled()) {
<i>1125</i>&nbsp;                return;
<i>1126</i>&nbsp;            }
<i>1127</i>&nbsp;            MenuSelectionManager manager = e.getMenuSelectionManager();
<i>1128</i>&nbsp;            MenuElement path[] = e.getPath();
<i>1129</i>&nbsp;            Point p = e.getPoint();
<i>1130</i>&nbsp;            if (p.x &gt;= 0 &amp;&amp; p.x &lt; menuItem.getWidth() &amp;&amp;
<i>1131</i>&nbsp;                    p.y &gt;= 0 &amp;&amp; p.y &lt; menuItem.getHeight()) {
<i>1132</i>&nbsp;                doClick(manager);
<i>1133</i>&nbsp;            } else {
<i>1134</i>&nbsp;                manager.clearSelectedPath();
<i>1135</i>&nbsp;            }
<i>1136</i>&nbsp;        }
<i>1137</i>&nbsp;
<i>1138</i>&nbsp;
<i>1139</i>&nbsp;        //
<i>1140</i>&nbsp;        // PropertyChangeListener
<i>1141</i>&nbsp;        //
<i>1142</i>&nbsp;        public void propertyChange(PropertyChangeEvent e) {
<i>1143</i>&nbsp;            String name = e.getPropertyName();
<i>1144</i>&nbsp;
<i>1145</i>&nbsp;            if (name == &quot;labelFor&quot; || name == &quot;displayedMnemonic&quot; ||
<i>1146</i>&nbsp;                name == &quot;accelerator&quot;) {
<i>1147</i>&nbsp;                updateAcceleratorBinding();
<i>1148</i>&nbsp;            } else if (name == &quot;text&quot; || &quot;font&quot; == name || &quot;foreground&quot; == name
<i>1149</i>&nbsp;                    || SwingUtilities2.isScaleChanged(e)) {
<i>1150</i>&nbsp;                // remove the old html view client property if one
<i>1151</i>&nbsp;                // existed, and install a new one if the text installed
<i>1152</i>&nbsp;                // into the JLabel is html source.
<i>1153</i>&nbsp;                JMenuItem lbl = ((JMenuItem) e.getSource());
<i>1154</i>&nbsp;                String text = lbl.getText();
<i>1155</i>&nbsp;                BasicHTML.updateRenderer(lbl, text);
<i>1156</i>&nbsp;            } else if (name  == &quot;iconTextGap&quot;) {
<i>1157</i>&nbsp;                defaultTextIconGap = ((Number)e.getNewValue()).intValue();
<i>1158</i>&nbsp;            } else if (name == &quot;horizontalTextPosition&quot;) {
<i>1159</i>&nbsp;                updateCheckIcon();
<i>1160</i>&nbsp;            }
<i>1161</i>&nbsp;        }
<i>1162</i>&nbsp;    }
<i>1163</i>&nbsp;}
</div>
</div>

<div class="footer">
    
    <div style="float:right;">generated on 2018-11-19 23:15</div>
</div>
</body>
</html>
